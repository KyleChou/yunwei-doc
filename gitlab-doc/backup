# 备份
gitlab-rake gitlab:backup:create

使用以上命令会在/var/opt/gitlab/backups目录下创建一个名称类似为1495449143_2017_05_22_gitlab_backup.tar的压缩包, 这个压缩包就是Gitlab整个的完整部分, 其中开头的1495449143是备份创建的日期.


# 备份路径修改

gitlab_rails['backup_path'] = '/mnt/backups'

gitlab-ctl reconfigure


# 自动备份

每天凌晨2点进行一次自动备份:

0 2 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create

# 数据恢复

# 停止相关数据连接服务
gitlab-ctl stop unicorn
gitlab-ctl stop sidekiq

# 从1495449143编号备份中恢复
gitlab-rake gitlab:backup:restore BACKUP=1495449143

# 启动Gitlab
sudo gitlab-ctl start

# Gitlab迁移

迁移如同备份与恢复的步骤一样, 只需要将老服务器/var/opt/gitlab/backups目录下的备份文件拷贝到新服务器上的/var/opt/gitlab/backups即可(如果你没修改过默认备份目录的话). 但是需要注意的是新服务器上的Gitlab的版本必须与创建备份时的Gitlab版本号相同
